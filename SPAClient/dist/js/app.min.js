!function(){var t=angular.module("jogTracker.api.auth",[]).config(["$httpProvider",function(t){t.interceptors.push("loginInterceptor")}]);t.value("userInfo",{access_token:null})}(),function(){var t=angular.module("jogTracker.api",["jogTracker.api.auth"]),e="https://dev.jogTracker.api",r=e+"/api/v1",o=function(t){return t?r+"/jog/"+t:r+"/jog"},n=function(t){return r+"/jog/"+t+"/update"},a=function(t){return r+"/user/"+t+"/update"},s=function(t){return t?r+"/user/"+t:r+"/user"},i=function(t){return r+"/jog/week/"+t};t.constant("apiUrls",{register:r+"/account/register",registerAsAdmin:r+"/account/registerAsAdmin",requestResetPwd:r+"/account/requestResetPwd",resetPwd:r+"/account/resetPwd",updateAccount:r+"/account",login:e+"/token",userInfo:r+"/account",users:s,user:s,updateUser:a,jogs:o,jogsForWeek:i,newJog:r+"/jog/new",updateJog:n})}(),angular.module("jogTracker",["jogTracker.api","jogTracker.validation","ui.router","ui.bootstrap","ngAnimate","toastr","angular-md5"]).config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/home/jogs"),t.state("login",{url:"/login",templateUrl:"partials/login.html"}).state("register",{url:"/register",templateUrl:"partials/register.html"}).state("resetpassword",{url:"/resetpassword",templateUrl:"partials/resetpassword.html"}).state("choosepassword",{url:"/choosepassword?{uid}&{token}",templateUrl:"partials/choosepassword.html"}).state("main",{url:"/home",templateUrl:"partials/main.html"}).state("main.jogs",{url:"/jogs",templateUrl:"partials/main.jogs.html"}).state("main.reports",{url:"/reports",templateUrl:"partials/main.reports.html"}).state("main.admin",{url:"/admin",templateUrl:"partials/main.admin.html"}).state("main.account",{url:"/account",templateUrl:"partials/main.account.html"})}]),Number.prototype.pad=function(t){for(var e=String(this);e.length<(t||2);)e="0"+e;return e},function(){angular.module("jogTracker.validation",[])}(),function(){function t(t,e,r,o){t.email="willem.odendaal@gmail.com",t.firstName="willem",t.lastName="odendaal",t.editMode=!1,t.buttonText="Save",t.disableButton=!1,t.loading=!0,t.edit={firstName:t.firstName,lastName:t.lastName},t.editDetails=function(){t.editMode=!0,t.edit.firstName=t.firstName,t.edit.lastName=t.lastName};var n=function(){e.getUserInfo().then(function(e){t.email=e.data.email,t.firstName=e.data.firstName,t.lastName=e.data.lastName,t.loading=!1})["catch"](function(e){r.showErrorToast(e,"Error fetching info"),t.loading=!1})};t.resetPassword=function(){o.go("resetpassword")};var a=function(e){e?(t.disableButton=!0,t.buttonText="Save..."):(t.disableButton=!1,t.buttonText="Save")};t.logout=function(){sessionStorage.access_token=null,o.go("login")},t.save=function(o){o&&e.update(t.edit.firstName,t.edit.lastName).then(function(){r.showSuccess("Details updated.","Success"),t.cancel(),t.firstName=t.edit.firstName,t.lastName=t.edit.lastName})["catch"](function(e){a(!1),500==e.status?r.showErrorToast(e,"Error saving details"):t.friendlyErrors=validatorUtils.getValidationErrors(e)})},t.cancel=function(){t.editMode=!1},n()}angular.module("jogTracker").controller("accountController",t),t.$inject=["$scope","accountFactory","notificationUtils","$state"]}(),function(){function t(t,e,r,o,n,a){t.friendlyErrors=[],t.showSuccess=!1,t.userId=n.uid,t.token=n.token,t.disableButton=!1,e.info("Reset page loaded with userId ["+t.userId+"] and token ["+t.token+"]"),t.resetPassword=function(){t.friendlyErrors=[],t.disableButton=!0,r.resetPwd(t.userId,t.newPassword,t.token).then(function(){t.showSuccess=!0,t.disableButton=!1})["catch"](function(e){t.disableButton=!1,t.showSuccess=!1,500==e.status?o.showErrorToast(e,"Reset password error"):t.friendlyErrors=a.getValidationErrors(e)})}}angular.module("jogTracker").controller("choosePasswordController",t),t.$inject=["$scope","$log","accountFactory","notificationUtils","$stateParams","validatorUtils"]}(),function(t){function e(e,r,o,n,a,s,i){function u(t){a.create(e.date,e.distanceKm,t).then(function(t){s.showSuccess("Jog created.","Success"),e.$emit("refresh"),e.closePanel()})["catch"](function(t){f(!1),500==t.status?s.showErrorToast(t,"Error creating jog"):e.friendlyErrors=i.getValidationErrors(t)})}function c(t,r){a.update(t,e.date,e.distanceKm,r).then(function(t){s.showSuccess("Jog updated.","Success"),e.$emit("refresh"),e.closePanel()})["catch"](function(t){f(!1),500==t.status?s.showErrorToast(t,"Error updating jog"):e.friendlyErrors=i.getValidationErrors(t)})}e.panelOpen=!0,e.dtFormat="yyyy/MM/dd",e.date=t().format("YYYY/MM/DD"),e.$on("editJog",function(t,e){d(e)});var l=function(){e.jogId=null,e.title="* New Jog",e.buttonText="Create New",e.friendlyErrors=[],e.disableButton=!1,e.opened=!1,e.durationMinutes=0,e.distanceKm=0},d=function(r){l(),e.jogId=r.id,e.panelOpen=!0,e.title="Edit Jog",e.buttonText="Update",e.date=r.date,e.durationMinutes=g(t.duration(r.duration)),e.distanceKm=r.distanceKm},f=function(t){t?(e.disableButton=!0,e.buttonText="Create new..."):(e.disableButton=!1,e.buttonText="Create new")};e.startAddNew=function(){l(),e.panelOpen=!0},e.closePanel=function(){e.panelOpen=!1,l()},e.toggleDatePicker=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!e.opened};var g=function(e){var r="00:00:00";if(!e)return r;if(e.asMinutes)r=e.hours().pad(2)+":"+e.minutes().pad(2)+":"+e.seconds().pad(2);else if(e.indexOf(":")>-1){var o=t.duration(e);r=o.hours().pad(2)+":"+o.minutes().pad(2)+":"+o.seconds().pad(2)}else{var o=t.duration(Number(e),"minutes");r=o.hours().pad(2)+":"+o.minutes().pad(2)+":"+o.seconds().pad(2)}return r};e.save=function(t){if(t){f(!0),e.friendlyErrors=[];var r=g(e.durationMinutes);null==e.jogId?u(r):c(e.jogId,r)}},l()}angular.module("jogTracker").controller("jogEditController",e),e.$inject=["$scope","$log","$rootScope","$stateParams","jogDataFactory","notificationUtils","validatorUtils"]}(moment),function(t,e){function r(r,o,n,a){r.jogs=[],r.pageNumber=1,r.pageSize=3,r.totalItems=0,r.dtPickers={from:{opened:!1,date:t().subtract(1,"months").format(r.dtFormat)},to:{opened:!1,date:t().format(r.dtFormat)}},r.dtFormat="yyyy/MM/dd",r.noData=function(){return 0==r.jogs.length},r.$on("refresh",function(){i()}),r.pageChanged=function(){i()},r.dateChanged=function(){i()},r.selectJog=function(t){s(t.id),a.$broadcast("editJog",t)},r.toggleDatePicker=function(t,e){t.preventDefault(),t.stopPropagation(),e.opened=!e.opened};var s=function(t){e.each(r.jogs,function(e){e.selected=e.id==t})},i=function(){var e=r.dtPickers.from.date,a=r.dtPickers.to.date;e||(e=t().subtract(1,"months")),a||(a=t()),o.getList(e,a,r.pageNumber-1,r.pageSize).then(function(t){r.totalItems=t.TotalResults,r.jogs=t.Items})["catch"](function(t){n.showErrorToast(t,"Error listing jogs")})};i()}angular.module("jogTracker").controller("jogsController",r),r.$inject=["$scope","jogDataFactory","notificationUtils","$rootScope"]}(moment,_),function(){function t(t,e,r,o,n,a){t.disableButton=!1,t.buttonText="Login",t.friendlyErrors=[];var s=function(e){e?(t.disableButton=!0,t.buttonText="Login..."):(t.disableButton=!1,t.buttonText="Login")};t.login=function(){s(!0),t.friendlyErrors=[],o.login(t.email,t.password).then(function(t){sessionStorage.access_token=t,r.go("main.jogs")})["catch"](function(e){s(!1),500==e.status?n.showErrorToast(e,"Login Error"):t.friendlyErrors=a.getValidationErrors(e)})},e.info("Login controller loaded.")}angular.module("jogTracker").controller("loginController",t),t.$inject=["$scope","$log","$state","accountFactory","notificationUtils","validatorUtils"]}(),function(){function t(t,e,r,o,n,a){t.userFirstName="User",t.userImage="",t.isAdmin=!1,t.gravatar={},t.getUserImage=function(e,r){if(t.gravatar[e+r])return t.gravatar[e+r];var o=n.createHash(e||"");return t.gravatar[e+r]="http://www.gravatar.com/avatar/"+o+"?s="+r+"&d=identicon",t.gravatar[e+r]};var s=function(){o.getUserInfo().then(function(e){t.userFirstName=e.data.firstName,t.userLastName=e.data.lastName,t.userImage=t.getUserImage(e.data.email,20),t.isAdmin=e.data.isAdmin,t.isUserManager=e.data.isUserManager})["catch"](function(t){a.showErrorToast(t,"Error fetching info")})};t.registerPlease=function(){var e=o.register(t.email,t.firstName,t.lastName,t.password);e.then(function(){alert("Registration done, and happy.")})["catch"](function(){alert("something went wrong.")})},t.$on("must-login",function(){r.go("login")}),s(),e.info("Main controller loaded.")}angular.module("jogTracker").controller("mainController",t),t.$inject=["$scope","$log","$state","accountFactory","md5","notificationUtils"]}(),function(){function t(t,e,r,o,n,a){t.friendlyErrors=[],t.disableButton=!1,t.buttonText="Register";var s=function(e){e?(t.disableButton=!0,t.buttonText="Registering..."):(t.disableButton=!1,t.buttonText="Register")},i=function(){s(!0),o.login(t.email,t.password).then(function(t){sessionStorage.access_token=t,r.go("main.jogs")})["catch"](function(t){a.showErrorToast(t,"Login Error"),s(!1)})};t.register=function(){s(!0),t.friendlyErrors=[],o.register(t.email,t.firstName,t.lastName,t.password).then(i)["catch"](function(e){s(!1),500==e.status?a.showErrorToast(e,"Registration Error"):t.friendlyErrors=n.getValidationErrors(e)})},e.info("Login controller loaded.")}angular.module("jogTracker").controller("registerController",t),t.$inject=["$scope","$log","$state","accountFactory","validatorUtils","notificationUtils"]}(),function(t,e){function r(t,r,n){function a(r){t.jogCount=r.length;for(var o=0,n=e.duration(0),a=0;a<r.length;a++)o+=Number(r[a].distanceKm),n.add(r[a].duration);t.distanceKm=o,t.duration=n.hours().pad(2)+":"+n.minutes().pad(2)+":"+n.seconds().pad(2),t.averageKmh=n.asHours()>0?o/n.asHours():0}t.jogCount=0,t.distanceKm=0,t.duration=0,t.averageKmh=0,t.currentDate=e(),t.weekStart=t.currentDate.startOf("week").add(1,"days").format(o),t.weekEnd=t.currentDate.endOf("week").add(1,"days").format(o),t.previousWeek=function(){var r=e(t.currentDate).subtract(7,"days");t.currentDate=r,t.weekStart=e(r).startOf("week").add(1,"days").format(o),t.weekEnd=e(r).endOf("week").add(1,"days").format(o),s()},t.nextWeek=function(){var r=e(t.currentDate).add(7,"days");t.currentDate=r,t.weekStart=e(r).startOf("week").add(1,"days").format(o),t.weekEnd=e(r).endOf("week").add(1,"days").format(o),s()};var s=function(){t.jogCount="Loading...",r.getListForWeek(t.currentDate).then(function(t){a(t)})["catch"](function(t){n.showErrorToast(t,"Error listing jogs")})};s()}angular.module("jogTracker").controller("reportsController",r),r.$inject=["$scope","jogDataFactory","notificationUtils"];var o="dddd, DD MMM YYYY"}(_,moment),function(){function t(t,e,r){t.showSuccess=!1,t.resetPassword=function(){t.showSuccess=!0,e.requestResetPwd(t.email).then(function(){})["catch"](function(e){t.showSuccess=!1,r.showErrorToast(e,"Reset Password Error")})}}angular.module("jogTracker").controller("resetPasswordController",t),t.$inject=["$scope","accountFactory","notificationUtils"]}(),function(){function t(t,e,r,o,n){function a(){r.registerAsAdmin(t.email,t.firstName,t.lastName,t.password,!1,t.userManager).then(function(){o.showSuccess("User created.","Success"),t.$emit("refresh"),t.closePanel()})["catch"](function(e){c(!1),500==e.status?o.showErrorToast(e,"Error creating user"):t.friendlyErrors=n.getValidationErrors(e)})}function s(r){e.update(r,t.email,t.firstName,t.lastName).then(function(){o.showSuccess("User updated.","Success"),t.$emit("refresh"),t.closePanel()})["catch"](function(e){c(!1),500==e.status?o.showErrorToast(e,"Error updating user"):t.friendlyErrors=n.getValidationErrors(e)})}t.panelOpen=!1,t.editMode=!1,t.$on("editUser",function(t,e){u(e)});var i=function(){t.editMode=!1,t.userId=null,t.title="* New User",t.buttonText="Create New",t.friendlyErrors=[],t.disableButton=!1,t.opened=!1,t.email="",t.firstName="",t.lastName="",t.password="",t.userManager=!1},u=function(e){i(),t.editMode=!0,t.userId=e.id,t.panelOpen=!0,t.title="Edit User",t.buttonText="Update",t.email=e.email,t.firstName=e.firstName,t.lastName=e.lastName,t.password="NotUsed",t.userManager=e.isUserManager},c=function(e){e?(t.disableButton=!0,t.buttonText="Create new..."):(t.disableButton=!1,t.buttonText="Create new")};t.startAddNew=function(){i(),t.panelOpen=!0},t.closePanel=function(){t.panelOpen=!1,i()},t.save=function(e){e&&(c(!0),t.friendlyErrors=[],null==t.userId?a():s(t.userId))},i()}angular.module("jogTracker").controller("userEditController",t),t.$inject=["$scope","userDataFactory","accountFactory","notificationUtils","validatorUtils"]}(),function(t){function e(e,r,o,n){e.users=[],e.pageNumber=1,e.pageSize=3,e.totalItems=0,e.noData=function(){return 0==e.users.length},e.$on("refresh",function(){s()}),e.pageChanged=function(){s()},e.selectUser=function(t){a(t.id),n.$broadcast("editUser",t)};var a=function(r){t.each(e.users,function(t){t.selected=t.id==r})},s=function(){r.getList(e.pageNumber-1,e.pageSize).then(function(t){e.totalItems=t.TotalResults,e.users=t.Items})["catch"](function(t){o.showErrorToast(t,"Error listing users")})};s()}angular.module("jogTracker").controller("usersController",e),e.$inject=["$scope","userDataFactory","notificationUtils","$rootScope"]}(_),function(){angular.module("jogTracker").directive("errorPanel",function(){return{restrict:"E",templateUrl:"/partials/errorPanel.html"}})}(),function(){angular.module("jogTracker").directive("jogEditPanel",function(){return{restrict:"E",templateUrl:"/partials/jogEditPanel.html"}})}(),function(){angular.module("jogTracker").directive("selectOnClick",["$window",function(t){return{restrict:"A",link:function(e,r,o){r.on("click",function(){t.getSelection().toString()||this.setSelectionRange(0,this.value.length)})}}}])}(),function(){angular.module("jogTracker").directive("userEditPanel",function(){return{restrict:"E",templateUrl:"/partials/userEditPanel.html"}})}(),function(){function t(t,e){var r=this;r.request=function(t){return sessionStorage.access_token&&(t.headers.authorization=sessionStorage.access_token),t},r.responseError=function(r){return(401===r.status||403===r.status)&&(sessionStorage.access_token=null,t.$broadcast("must-login")),e.reject(r)}}angular.module("jogTracker.api.auth").service("loginInterceptor",t),t.$inject=["$rootScope","$q"]}(),function(){function t(t,e,r,o){var n=function(e,r,o,n){t.info("Successful response from Api. Data: ",e,", status: ",r,", headers: ",o,"config: ",n)},a=function(n,a){var s=r.defer(),i="userName="+encodeURIComponent(n)+"&password="+encodeURIComponent(a)+"&grant_type=password";return e({url:o.login,data:i,method:"post"}).success(function(e,r,o,n){t.info("Login ok.");var a="bearer "+e.access_token;s.resolve(a)}).error(function(t){s.reject(t)}),s.promise},s=function(t,r,a,s){var i={email:t,firstName:r,lastName:a,password:s};return e.post(o.register,i).success(n)},i=function(t,r,a,s,i,u){var c={email:t,firstName:r,lastName:a,password:s,admin:i,userManager:u};return e.post(o.registerAsAdmin,c).success(n)},u=function(t){var r={email:t};return e.post(o.requestResetPwd,r).success(n)},c=function(t,r,a){var s={userId:t,newPassword:r,token:a};return e.post(o.resetPwd,s).success(n)},l=function(t){return console.log("Fetching current user info..."),e.get(o.userInfo)},d=function(t,r){var n={firstName:t,lastName:r};return e.put(o.updateAccount,n)};return{register:s,registerAsAdmin:i,login:a,getUserInfo:l,update:d,requestResetPwd:u,resetPwd:c}}angular.module("jogTracker.api").factory("accountFactory",t),t.$inject=["$log","$http","$q","apiUrls"]}(),function(){function t(t,r,o,n){t.info("jogDataFactory loaded.");var a=function(t,a,s,i){var u,c=n.defer();u=t.format?t.format(e):moment(t).format(e);var l;if(l=a.format?a.add(1,"days").format(e):moment(a).add(1,"days").format(e),moment(t)>moment(a)){var d=l;l=u,u=d}var f={fromDate:u,toDate:l,pageIndex:s,pageSize:i};return o.get(r.jogs(),{params:f}).success(function(t,e,r,o){c.resolve(t)}).error(function(t){c.reject(t)}),c.promise},s=function(t){var a,s=n.defer();a=t.format?t.format(e):moment(t).format(e);var i={week:a};return o.get(r.jogsForWeek(),{params:i}).success(function(t){s.resolve(t)}).error(function(t){s.reject(t)}),s.promise},i=function(t){return o.get(r.jogs(t),{params:{jogId:t}})},u=function(t){return o["delete"](r.jogs(t),{params:{jogId:t}})},c=function(t,e,n){var a={dateTime:t,distanceKm:e,duration:n};return o.post(r.newJog,a)},l=function(t,e,n,a){var s={dateTime:e,distanceKm:n,duration:a};return o.put(r.updateJog(t),s)};return{getList:a,getListForWeek:s,get:i,del:u,create:c,update:l}}angular.module("jogTracker.api").factory("jogDataFactory",t),t.$inject=["$log","apiUrls","$http","$q"];var e="YYYY-MM-DDT00:00:00"}(),function(){function t(t){var e=function(e,r){e.data.Message?t.error(e.data.Message,r):t.error(e.statusText,r)},r=function(e,r){t.success(e,r)};return{showErrorToast:e,showSuccess:r}}angular.module("jogTracker").factory("notificationUtils",t),t.$inject=["toastr"]}(),function(){function t(t,e,r,o){var n=function(t,n){var a=o.defer(),s={pageIndex:t,pageSize:n};return r.get(e.users(),{params:s}).success(function(t,e,r,o){a.resolve(t)}).error(function(t){a.reject(t)}),a.promise},a=function(t){return r.get(e.user(t),{params:{userId:t}})},s=function(t,o,n,a){var s={userId:t,email:o,firstName:n,lastName:a};return r.put(e.updateUser(t),s)};return{getList:n,get:a,update:s}}angular.module("jogTracker.api").factory("userDataFactory",t),t.$inject=["$log","apiUrls","$http","$q"]}(),function(){function t(){var t=function(t){if(!t.data||!t.data.ModelState)return t.error_description?[t.error_description]:["Request contained invalid data."];var e=[];for(var r in t.data.ModelState)if(t.data.ModelState.hasOwnProperty(r))for(var o=t.data.ModelState[r],n=0;n<o.length;n++)e.push(o[n]);return e};return{getValidationErrors:t}}angular.module("jogTracker.validation").factory("validatorUtils",t),t.$inject=[]}();
//# sourceMappingURL=app.min.js.map