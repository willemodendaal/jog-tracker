(function() {
    var apiModule = angular.module('jogTracker.api', []);

    var host = 'https://dev.jogTracker.api';
    var baseUrl = host + '/api/v1';

    apiModule.constant('apiUrls', {
        register: baseUrl + '/account/register',
        registerAsAdmin: baseUrl + '/account/registerAsAdmin',
        requestResetPwd: baseUrl + '/account/requestResetPwd',
        resetPwd: baseUrl + '/account/resetPwd',
        login: host + '/token'
    });

}());


angular.module('jogTracker', ['jogTracker.api', 'ui.router'])

    .config(function($stateProvider, $urlRouterProvider){

        //By default, go home.
        $urlRouterProvider.otherwise("/");

        $stateProvider
            .state('login', {
                url: "/login",
                templateUrl: "partials/login.html"
            })
            .state('register', {
                url: "/register",
                templateUrl: "partials/register.html"
            })
            .state('main', {
                url: "/",
                templateUrl: "partials/main.html"
            })
            .state('main.jogs', {
                url: "jogs",
                templateUrl: "partials/main.jogs.html"
            })
            .state('main.reports', {
                url: "reports",
                templateUrl: "partials/main.reports.html"
            })
            .state('main.admin', { //For admin functions, like user maintenance.
                url: "admin",
                templateUrl: "partials/main.admin.html"
            });
    });

(function () {

    angular
        .module('jogTracker')
        .controller('mainController', mainController);

    mainController.$inject = ['$scope', '$log', 'jogDataFactory', 'accountFactory'];

    function mainController($scope, $log, jogDataFactory, accountFactory) {
        $scope.registerPlease = function () {
            var p = accountFactory.register($scope.email, $scope.firstName, $scope.lastName, $scope.password);

            p.then(function () {
                alert('Registration done, and happy.');
            })
                .catch(function () {
                    alert('something went wrong.');
                });
        };

        $log.info('Main controller loaded.');
    }

}());

(function(){
    angular.module('jogTracker.api.auth', ['$httpProvider'])
        .config(function($httpProvider) {
            $httpProvider.interceptors.push('APIInterceptor');
        });
}());

(function() {

    angular.module('jogTracker.api')
        .factory('accountFactory', accountFactory);

    accountFactory.$inject = ['$log', '$http', '$q', 'apiUrls'];

    function accountFactory($log, $http, $q, apiUrls) {

        var _successLog = function (data, status, headers, config) {
            $log.info('Successful response from Api. Data: ', data, ', status: ', status, ', headers: ', headers, 'config: ', config);
        };

        /*          *
         *  Login   *
         *          */
        var login = function(email, password) {
            //Logs in, and resolves promise with Token.
            var payload = {
                userName: email,
                password: password,
                grant_type: 'password'
            };

            var deferred = $q.defer();

            $http.post(apiUrls.login, payload)
                .success(function (data, status, headers, config) {
                    $log.info('Login ok.');
                    var token = data.access_token;
                    deferred.resolve(token);
                })
                .error(function (err) {
                    deferred.reject(err);
                });

            return deferred.promise;
        };

        /*             *
         *   Register  *
         *             */
        var register = function(email, firstName, lastName, password) {
            var payload = {
                email: email,
                firstName: firstName,
                lastName: lastName,
                password: password
            };

            return $http.post(apiUrls.register, payload).success(_successLog);
        };


        /*                    *
         *   RegisterAsAdmin  *
         *                    */
        //Protected by role-based security on the server.
        var registerAsAdmin = function(email, firstName, lastName, password, makeAdmin) {
            var payload = {
                email: email,
                firstName: firstName,
                lastName: lastName,
                password: password,
                admin: makeAdmin
            };

            return $http.post(apiUrls.registerAsAdmin, payload).success(_successLog);
        };


        return {
            register : register,
            registerAsAdmin: registerAsAdmin,
            login : login
        };
    }
}());


(function() {

    angular.module('jogTracker.api')
        .factory('jogDataFactory', jogDataFactory);

    jogDataFactory.$inject = ['$log'];

    function jogDataFactory($log) {
        $log.info('jogDataFactory loaded.');

        return 100;
    }
}());

//# sourceMappingURL=app.min.js.map