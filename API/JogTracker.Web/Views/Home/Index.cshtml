@{
    ViewBag.Title = "Home Page";
}

@section scripts
{
    <script>
        //Some basic JQuery handlers for now. Will switch to Angular soon.
        $( function() {

            $('#login').click(handleLogin);
            $('#logoff').click(handleLogoff);
            $('#access-secure').click(handleSecureContent);
            var server = 'https://localhost:44301/';

            var access_token = null;
            function handleLogin() {
                var loginData = 'grant_type=password&username=willem.odendaal@gmail.com&password=runUpYonderHills!';

                //Get token from server.
                $.post(server + 'Token', loginData)
                    .done(function(data) {
                        console.log(data);
                        access_token = data.access_token;
                        alert('OK');
                    })
                    .fail(function(err,a) {
                        console.log(err,a);
                        alert('error. See console for more info.');
                    });
            }

            function handleLogoff() {
                   access_token = null;
                   alert('Logged off.');
            }

            function handleSecureContent() {
                $.ajax(server+ 'api/v1/jog',
                {
                    headers: {'Authorization': 'bearer ' + access_token},
                    method: 'GET'
                })
                .done(function(data) {
                    console.log(data);
                    alert('hapiness. See log');
                })
                .fail(function(err,a) {
                        if (err.status == 401)
                        {
                            alert('Please log on again.');
                            return;
                        }

                        console.log(err,a);
                        alert('error. See console for more info.');
                });
            }


        } );
    </script>
}

<div class="jumbotron">
    <h1>Jogging Time Tracker</h1>
    <p class="lead">All you need to leave the competition far behind.</p>
    <p><a href="http://asp.net" class="btn btn-primary btn-lg">Learn more &raquo;</a></p>
</div>

<div class="row">
    <div class="col-md-4">
        <h2>Login tester</h2>
        <p>
            Use these buttons to test logging in to the API.
        </p>
        <p><a class="btn btn-default" id="login" href="javascript:void(0);">Login &raquo;</a></p>
        <p><a class="btn btn-default" id="access-secure" href="javascript:void(0);">Access secure resource &raquo;</a></p>
        <p><a class="btn btn-default" id="logoff" href="javascript:void(0);">Logoff &raquo;</a></p>
    </div>

    <div class="col-md-4">
        <h2>Column</h2>
        <p>
            Column content
        </p>
        <p><a class="btn btn-default" href="http://go.microsoft.com/fwlink/?LinkId=301865">Learn more &raquo;</a></p>
    </div>

    <div class="col-md-4">
        <h2>Column</h2>
        <p>
            Column content
        </p>
        <p><a class="btn btn-default" href="http://go.microsoft.com/fwlink/?LinkId=301865">Learn more &raquo;</a></p>
    </div>
    
</div>